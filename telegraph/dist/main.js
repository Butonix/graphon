var Telegraph=function(t){var e={};function s(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}return s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(i,r,function(e){return t[e]}.bind(null,r));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){"use strict";s.r(e);class i{constructor(t){this.columns=t.columns,this.colors=t.colors,this.names=t.names,this.types=t.types}get dates(){return this.columns[0].slice(1)}get linesAvailable(){return Object.keys(this.names)}get daysCount(){return this.columns[0].length-1}getLinePoints(t){return this.getColumnByName(t).slice(1)}getColumnByName(t){return this.columns[this.columns.findIndex(e=>e[0]===t)]}getPointsSlice(t,e,s){return this.getLinePoints(t).slice(e,e+s)}getLineColor(t){return this.colors[t]}get max(){const t=this.linesAvailable.map(t=>Math.max(...this.getLinePoints(t)));return Math.max(...t)}get colorsList(){return Object.entries(this.colors).map(([t,e])=>e)}get namesList(){return Object.entries(this.names).map(([t,e])=>e)}}function r(t,e,s={}){const i=["svg","path","rect","circle","text"].includes(t)?document.createElementNS("http://www.w3.org/2000/svg",t):document.createElement(t);if(Array.isArray(e)&&e.length?i.classList.add(...e):e&&(i.className=e),s&&Object.keys(s).length)for(let t in s)s.hasOwnProperty(t)&&i.setAttribute(t,s[t]);return i}function h(t){if(t<1e3)return t;if(t<1e4){let e=Math.floor(t/1e3),s=t-1e3*e;return s>100?e+" "+s:s>10?e+" 0"+s:e+" 00"+s}return t<1e6?Math.floor(t/1e3)+"k":Math.floor(t/1e6)+"M"}class n{constructor({color:t,svg:e,max:s,stroke:i,stepX:h,opacity:n=1}){this.svg=e,this.kY=0!==s?this.canvasHeight/s:1,this.stepX=h,this.prevX=0,this.path=r("path",null,{"stroke-width":i,stroke:t,fill:"transparent","stroke-linecap":"round","vector-effect":"non-scaling-stroke",opacity:n}),this.pathData=""}static get CSS(){return{graphHidden:"tg-graph--hidden"}}get canvasHeight(){return parseInt(this.svg.style.height,10)}get canvasWidth(){return this.svg.offsetWidth}y(t){return Math.round(this.canvasHeight-t*this.kY)}x(t){return t}moveTo(t,e){this.pathData+=`M ${this.x(t)} ${this.y(e)}`}stepTo(t){this.prevX=this.prevX+this.stepX,this.pathData+=` L ${this.x(this.prevX)} ${this.y(t)}`}lineTo(t,e){this.pathData+=` L ${this.x(t)} ${this.y(e)}`}render(){this.path.setAttribute("d",this.pathData),this.svg.appendChild(this.path),this.animate()}dropText(t){let e=r("text",null,{x:this.prevX+this.stepX,y:this.y(t),fill:"#cccccc",textAnchor:"left","dominant-baseline":"use-script"});e.appendChild(document.createTextNode(t)),e.style.fontSize="13px",this.svg.appendChild(e)}animate(){const t=this.path.getTotalLength();this.path.style.transition=this.path.style.WebkitTransition="none",this.path.style.strokeDasharray=t+" "+t,this.path.style.strokeDashoffset=t,this.path.getBoundingClientRect(),this.path.style.transition=this.path.style.WebkitTransition="stroke-dashoffset 2000ms ease-in",this.path.style.strokeDashoffset="0",setTimeout(()=>{this.path.style.removeProperty("transition"),this.path.style.removeProperty("stroke-dasharray"),this.path.style.removeProperty("stroke-dashoffset")},2e3)}scaleX(t){let e=this.path.style.transform;e.includes("scaleX")?this.path.style.transform=e.replace(/(scaleX\(\S+\))/,`scaleX(${t})`):this.path.style.transform=e+` scaleX(${t})`}scaleY(t){let e=this.path.style.transform;e.includes("scaleY")?this.path.style.transform=e.replace(/(scaleY\(\S+\))/,`scaleY(${t})`):this.path.style.transform=e+` scaleY(${t})`}get isHidden(){return this.path.classList.contains(n.CSS.graphHidden)}toggleVisibility(){this.path.classList.toggle(n.CSS.graphHidden)}}class a{constructor(t,{stroke:e}){this.state=t,this.canvas=void 0,this.legend=void 0,this.grid=void 0,this.stepX=45,this.stepY=10,this.strokeWidth=e,this.initialWidth=void 0,this.maxPoint=1.2*this.state.max,this.paths={}}static get CSS(){return{grid:"tg-grid",gridSection:"tg-grid__section"}}get pathsList(){return Object.entries(this.paths).map(([t,e])=>e)}renderCanvas({width:t,height:e}={}){return this.canvas=r("svg"),t?(this.canvas.style.width=t+"px",this.initialWidth=t):this.setCanvasWidth(),e&&(this.canvas.style.height=e+"px"),this.computeSteps(),this.canvas}setCanvasWidth(){this.initialWidth=this.state.daysCount*this.stepX,this.canvas.style.width=this.initialWidth+"px"}get width(){return parseInt(this.canvas.style.width,10)}get height(){return parseInt(this.canvas.style.height,10)}computeSteps(){this.stepX=Math.ceil(parseInt(this.canvas.style.width,10)/this.state.daysCount);const t=this.state.max;this.stepY=[1,10,100,1e3,1e4,1e5,1e6,1e7].reverse().find(e=>t>e)}renderLine(t){const e=this.state.getLinePoints(t),s=this.state.getLineColor(t),i=e[0],r=new n({svg:this.canvas,color:s,max:this.maxPoint,stroke:this.strokeWidth,stepX:this.stepX});r.moveTo(0,i),e.forEach(t=>{r.stepTo(t)}),r.render(),this.paths[t]=r}renderGrid(t){this.grid&&this.grid.remove(),this.grid=r("div",a.CSS.grid);let e=this.stepY;const s=this.height,i=(this.width,s/(t||this.maxPoint));let n=s/(e*i)>>0;0===n&&(n=s/((e/=3)*i)>>0);for(let t=0;t<=n;t++){let s=t*e,n=r("div",a.CSS.gridSection);0===t&&n.classList.add("no-animation"),n.style.bottom=s*i+"px",n.textContent=h(Math.round(s)),this.grid.appendChild(n)}var o,l;o=this.canvas.parentNode,l=this.grid,o.parentNode.insertBefore(l,o)}renderLegend(t){var e,s;this.legend=r("footer"),t.forEach((t,e)=>{if(e%2==1)return;const s=new Date(t),i=r("time");i.textContent=s.toLocaleDateString("en-US",{day:"numeric",month:"short"}),this.legend.appendChild(i)}),e=this.canvas,s=this.legend,e.parentNode.insertBefore(s,e.nextSibling)}scaleLines(t){this.pathsList.forEach(e=>{e.scaleX(t)});const e=this.initialWidth*t;this.canvas.style.width=e+"px";const s=Math.round(e/this.stepX),i=Math.round(this.initialWidth/this.stepX),r=Math.floor(i/s+.9);r%2==1&&this.legend.classList.add(`skip-${r}`),this.legend.classList.toggle("skip-odd",i/s>1.7),this.legend.classList.toggle("skip-odd",i/s>1.7),this.legend.classList.toggle("skip-third",i/s>3.8),this.legend.classList.toggle("skip-fifth",i/s>5.5),this.legend.classList.toggle("skip-seventh",i/s>7)}get step(){return this.stepX}scaleToMaxPoint(t){let e=this.maxPoint/t*.8;this.pathsList.forEach(t=>{t.scaleY(e)}),this.renderGrid(1.2*t)}checkPathVisibility(t){return!this.paths[t].isHidden}togglePathVisibility(t){this.paths[t].toggleVisibility()}}class o{constructor(t){this.modules=t,this.state=t.state,this.nodes={wrapper:void 0,canvas:void 0,leftZone:void 0,leftZoneScaler:void 0,rightZone:void 0,rightZoneScaler:void 0},this.wrapperWidthCached=void 0,this.viewportWidth=100,this.viewportWidthInitial=100,this.viewportOffsetLeft=0,this.moveStartX=void 0,this.moveStartLayerX=void 0,this.wrapperLeftCoord=void 0,this.viewportPressed=!1,this.leftScalerClicked=!1,this.rightScalerClicked=!1,this.graph=new a(this.state,{stroke:1})}static get CSS(){return{wrapper:"tg-minimap",leftZone:"tg-minimap__left",leftZoneScaler:"tg-minimap__left-scaler",rightZone:"tg-minimap__right",rightZoneScaler:"tg-minimap__right-scaler"}}renderUi(){return this.nodes.wrapper=r("div",o.CSS.wrapper),this.nodes.leftZone=r("div",o.CSS.leftZone),this.nodes.rightZone=r("div",o.CSS.rightZone),this.nodes.leftZoneScaler=r("div",o.CSS.leftZoneScaler),this.nodes.rightZoneScaler=r("div",o.CSS.rightZoneScaler),this.nodes.leftZone.appendChild(this.nodes.leftZoneScaler),this.nodes.rightZone.appendChild(this.nodes.rightZoneScaler),this.nodes.wrapper.appendChild(this.nodes.leftZone),this.nodes.wrapper.appendChild(this.nodes.rightZone),this.bindEvents(),this.nodes.wrapper}renderMap(){this.nodes.canvas=this.graph.renderCanvas({width:this.nodes.wrapper.offsetWidth,height:this.nodes.wrapper.offsetHeight}),this.state.linesAvailable.forEach(t=>{this.graph.renderLine(t)}),this.setInitialPosition(),this.nodes.wrapper.appendChild(this.nodes.canvas)}get wrapperWidth(){return this.wrapperWidthCached||this.nodes.wrapper.offsetWidth}get width(){return this.wrapperWidth-parseInt(this.nodes.leftZone.style.width,10)-parseInt(this.nodes.rightZone.style.width,10)}set width(t){const e=this.modules.chart.scrollDistance;this.nodes.leftZone.style.width=e+"px",this.nodes.rightZone.style.width=this.wrapperWidth-e-t+"px",this.viewportWidth=t}setInitialPosition(){let t=this.nodes.wrapper.getBoundingClientRect();this.wrapperWidthCached=t.width,this.wrapperLeftCoord=t.left;const e=this.modules.chart.viewportWidth/this.modules.chart.width;this.width=this.wrapperWidth*e,this.viewportWidthInitial=this.width,this.viewportOffsetLeft=0,this.moveViewport(this.viewportOffsetLeft),this.syncScrollWithChart()}get scrolledValue(){return parseInt(this.nodes.leftZone.style.width,10)}moveViewport(t){const e=this.width,s=this.wrapperWidth-e;let i=this.viewportOffsetLeft+t;i<0?i=0:i>s&&(i=s),this.nodes.leftZone.style.width=i+"px",this.nodes.rightZone.style.width=this.wrapperWidth-e-i}bindEvents(){this.nodes.wrapper.addEventListener("mousedown",t=>{this.viewportMousedown(t)}),this.nodes.wrapper.addEventListener("mousemove",t=>{this.viewportMousemove(t)}),this.nodes.wrapper.addEventListener("mouseleave",t=>{this.viewportMouseleave(t)}),this.nodes.wrapper.addEventListener("mouseup",t=>{this.viewportMouseup(t)}),this.nodes.wrapper.addEventListener("touchstart",t=>{this.viewportMousedown(t)}),this.nodes.wrapper.addEventListener("touchmove",t=>{this.viewportMousemove(t)}),this.nodes.wrapper.addEventListener("touchcancel",t=>{this.viewportMouseleave(t)}),this.nodes.wrapper.addEventListener("touchend",t=>{this.viewportMouseup(t)})}viewportMousedown(t){const{target:e}=t;t.preventDefault();const s=!!e.closest(`.${o.CSS.leftZoneScaler}`),i=!!e.closest(`.${o.CSS.rightZoneScaler}`);if(this.moveStartX=t.touches?t.touches[0].pageX:t.pageX,this.moveStartLayerX=t.touches?t.touches[0].layerX:t.layerX,s||i)return this.leftScalerClicked=s,this.rightScalerClicked=i,void(this.viewportPressed=!1);this.viewportPressed=!0}viewportMousemove(t){this.viewportPressed?this.viewportDragged(t):this.leftScalerClicked?this.scalerDragged(t,"left"):this.rightScalerClicked&&this.scalerDragged(t,"right")}viewportMouseleave(t){this.viewportPressed?this.finishSliding():this.leftScalerClicked?this.finishLeftScaling():this.rightScalerClicked&&this.finishRightScaling()}viewportMouseup(){this.viewportPressed?this.finishSliding():this.leftScalerClicked?this.finishLeftScaling():this.rightScalerClicked&&this.finishRightScaling()}finishSliding(){this.viewportPressed=!1,this.viewportOffsetLeft=parseInt(this.scrolledValue,10)}finishLeftScaling(){this.leftScalerClicked=!1}finishRightScaling(){this.rightScalerClicked=!1}viewportDragged(t){let e=t.pageX-this.moveStartX;t.touches&&(e=t.touches[0].pageX),this.moveViewport(e),this.syncScrollWithChart(),this.modules.chart.fitToMax()}syncScrollWithChart(){const t=this.scrolledValue/this.wrapperWidth*this.modules.chart.width;this.modules.chart.scroll(t)}scalerDragged(t,e){let s=t.layerX-this.moveStartLayerX,i=t.pageX-this.moveStartX<0?"left":"right";if(!s)return;s>5?(s=5,"left"===e&&(s="left"===i?-5:5)):s<-5&&(s=-5),"left"===e?(s*=-1,this.nodes.leftZone.style.width=parseInt(this.nodes.leftZone.style.width)-s+"px",this.syncScrollWithChart()):this.nodes.rightZone.style.width=parseInt(this.nodes.rightZone.style.width)-s+"px";const r=this.viewportWidthInitial/this.width;this.modules.chart.scale(r),this.modules.chart.fitToMax()}}class l{constructor(t){this.modules=t,this.nodes={wrapper:void 0,title:void 0,values:void 0}}static get CSS(){return{wrapper:"tg-tooltip",showed:"tg-tooltip--showed",title:"tg-tooltip__title",values:"tg-tooltip__values",value:"tg-tooltip__values-item"}}render(){return this.nodes.wrapper=r("div",l.CSS.wrapper),this.nodes.title=r("div",l.CSS.title),this.nodes.values=r("div",l.CSS.values),this.nodes.wrapper.appendChild(this.nodes.title),this.nodes.wrapper.appendChild(this.nodes.values),this.nodes.wrapper}show(){this.nodes.wrapper.classList.add(l.CSS.showed)}hide(){this.nodes.wrapper.classList.remove(l.CSS.showed)}move(t){let e=-25;const s=this.nodes.wrapper.offsetWidth;t>this.modules.chart.viewportWidth-s/3?e=-1.1*s:t>this.modules.chart.viewportWidth-s?e=-.8*s:t<45&&(e=20),this.nodes.wrapper.style.left=`${t+e}px`}clear(){this.nodes.title.textContent="",this.nodes.values.innerHTML=""}set values(t){this.clear(),t.forEach(({name:t,value:e})=>{const s=r("div",l.CSS.value),i=this.modules.state.colors[t],n=this.modules.state.names[t];s.innerHTML=`<b>${h(e)}</b>${n}`,s.style.color=i,this.nodes.values.appendChild(s)})}set title(t){this.nodes.title.innerHTML=t}}class d{constructor(t){this.modules=t,this.state=t.state,this.nodes={wrapper:void 0,viewport:void 0,canvas:void 0,cursorLine:void 0},this.tooltip=new l(this.modules),this.graph=new a(this.state,{stroke:3}),this.wrapperLeftCoord=void 0,this.scaling=1,this.scrollValue=0}static get CSS(){return{wrapper:"tg-chart",viewport:"tg-chart__viewport",cursorLine:"tg-chart__cursor-line"}}get scrollDistance(){return this.scrollValue*this.scaling}get scalingValue(){return this.scaling}renderUi(){return this.nodes.wrapper=r("div",d.CSS.wrapper),this.nodes.viewport=r("div",d.CSS.viewport),this.nodes.cursorLine=r("div",d.CSS.cursorLine),this.nodes.wrapper.appendChild(this.nodes.viewport),this.nodes.wrapper.appendChild(this.nodes.cursorLine),this.nodes.wrapper.appendChild(this.tooltip.render()),this.bindEvents(),this.nodes.wrapper}renderCharts(){this.calculateWrapperCoords(),this.nodes.canvas=this.graph.renderCanvas({height:400}),this.nodes.viewport.appendChild(this.nodes.canvas);const t=this.state.dates;this.state.linesAvailable.forEach(t=>{this.graph.renderLine(t)}),this.graph.renderGrid(),this.graph.renderLegend(t)}get width(){return this.graph.width}get viewportWidth(){return this.nodes.wrapper.offsetWidth}get viewportHeight(){return this.nodes.wrapper.offsetHeight}scroll(t){let e=-1*t;this.nodes.viewport.style.transform=`translateX(${e}px)`,this.scrollValue=e}scale(t){this.graph.scaleLines(t),this.scaling=t}get leftPointIndex(){return Math.round(-1*this.scrollValue/this.graph.step/this.scaling)}notHiddenGraph(t){return this.graph.checkPathVisibility(t)}fitToMax(){const t=this.graph.step,e=Math.round(this.viewportWidth/t/this.scaling),s=Math.max(...this.state.linesAvailable.filter(t=>this.notHiddenGraph(t)).map(t=>{let s=this.state.getPointsSlice(t,this.leftPointIndex,e);return Math.max(...s)}));this.graph.scaleToMaxPoint(s)}calculateWrapperCoords(){let t=this.nodes.wrapper.getBoundingClientRect();this.wrapperLeftCoord=t.left}bindEvents(){this.nodes.wrapper.addEventListener("mousemove",t=>{this.mouseMove(t)}),this.nodes.wrapper.addEventListener("mouseleave",t=>{this.mouseLeave(t)})}mouseMove(t){let e=t.pageX-this.wrapperLeftCoord,s=Math.round(e/this.graph.stepX/this.scaling);this.tooltip.show();let i=this.scrollValue%this.graph.stepX,r=s*this.graph.stepX*this.scaling;this.nodes.cursorLine.style.left=`${r+i}px`;const h=this.leftPointIndex+s-1,n=this.state.linesAvailable.filter(t=>this.notHiddenGraph(t)).map(t=>({name:t,value:this.state.getLinePoints(t)[h]})),a=this.state.dates[h];a&&(this.tooltip.values=n,this.tooltip.move(r),this.tooltip.title=new Date(a).toLocaleDateString("en-US",{day:"numeric",month:"short",weekday:"short"}))}mouseLeave(){this.tooltip.hide()}togglePath(t){this.graph.togglePathVisibility(t),this.fitToMax()}}class p{constructor(t){this.modules=t,this.nodes={wrapper:void 0},this.buttons={}}static get CSS(){return{wrapper:"tg-legend",item:"tg-legend__item",itemEnabled:"tg-legend__item--enabled",checkbox:"tg-legend__checkbox"}}render(){return this.nodes.wrapper=r("div",p.CSS.wrapper),Object.entries(this.modules.state.names).map(([t,e])=>({name:t,title:e})).forEach(({name:t,title:e})=>{let s=r("div",[p.CSS.item,p.CSS.itemEnabled]),i=r("span",p.CSS.checkbox);i.style.borderColor=this.modules.state.colors[t],i.style.backgroundColor=this.modules.state.colors[t],s.appendChild(i),s.appendChild(document.createTextNode(e)),this.buttons[t]=s,s.addEventListener("click",()=>{this.itemClicked(t)}),this.nodes.wrapper.appendChild(s)}),this.nodes.wrapper}itemClicked(t){this.modules.chart.togglePath(t),this.buttons[t].classList.toggle(p.CSS.itemEnabled);const e=this.buttons[t].querySelector(`.${p.CSS.checkbox}`);this.buttons[t].classList.contains(p.CSS.itemEnabled)?e.style.backgroundColor=this.modules.state.colors[t]:e.style.backgroundColor="transparent"}}s.d(e,"default",function(){return c});class c{constructor({holderId:t,inputData:e}){this.holder=document.getElementById(t),this.state=new i(e),this.minimap=new o(this),this.chart=new d(this),this.legend=new p(this),this.prepareUi(),this.chart.renderCharts(),this.minimap.renderMap()}prepareUi(){this.holder.appendChild(this.chart.renderUi()),this.holder.appendChild(this.minimap.renderUi()),this.holder.appendChild(this.legend.render())}}}]);